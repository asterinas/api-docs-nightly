<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module introduces utilities to support Linux get/setsockopt syscalls."><title>aster_kernel::util::net::options - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="aster_kernel" data-themes="" data-resource-suffix="" data-rustdoc-version="1.94.0-nightly (1aa9bab4e 2025-12-05)" data-channel="nightly" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module options</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../aster_kernel/index.html">aster_<wbr>kernel</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module options</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#example" title="Example">Example</a></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In aster_<wbr>kernel::<wbr>util::<wbr>net</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../../index.html">aster_kernel</a>::<wbr><a href="../../index.html">util</a>::<wbr><a href="../index.html">net</a></div><h1>Module <span>options</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../src/aster_kernel/util/net/options/mod.rs.html#3-192">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module introduces utilities to support Linux get/setsockopt syscalls.</p>
<p>These two syscalls are used to get/set options for a socket. These options can be at different
socket levels and of different types. To provide a unified interface, the <code>Socket</code> trait accepts
a <code>dyn SocketOption</code> as a parameter. For each socket option, We define a struct that implements
the <code>SocketOption</code> trait in net module.</p>
<p>However, different socket options may have values of different types. For example, the values can
be u32, C structs, or byte arrays. Furthermore, some values may have different formats in kernel
space and user space. For example, for the option <code>ReusePort</code>, the user space may use an i32 while
the kernel space may use a bool.</p>
<p>We introduce the <code>RawSocketOption</code> trait for reading/writing socket options from/to user space. It
can read/write values of different types and can convert the user type to the kernel type when
reading from the user space and vice versa when writing to the user space. The <code>RawSocketOption</code>
should not be implemented for a type by hand, and we provide macros to automatically implement the
trait.</p>
<h2 id="example"><a class="doc-anchor" href="#example">Â§</a>Example</h2>
<p>Suppose we want to add a new option <code>TcpNodelay</code>.</p>
<p>First, the option should be added in the net module for the TCP socket.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">impl_socket_option!</span>(TcpNodelay(bool));</code></pre></div>
<p>Then, we need to implement the <code>ReadFromUser</code> and <code>WriteFromUser</code> traits for the bool type
in the utils module. These util functions can be shared if multiple options have the value
of same type.</p>

<div class="example-wrap compile_fail"><a href="#" class="tooltip" title="This example deliberately fails to compile">â“˜</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>ReadFromUser <span class="kw">for </span>bool {
    <span class="comment">// content omitted here
</span>}
<span class="kw">impl </span>WriteFromUser <span class="kw">for </span>bool {
    <span class="comment">// content omitted here
</span>}</code></pre></div>
<p>At last, we can implement <code>RawSocketOption</code> for <code>TcpNodelay</code> so that it can be read/from
user space.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">impl_raw_socket_option!</span>(TcpNodeley);</code></pre></div>
<p>At the syscall level, the interface is unified for all options and does not need to be modified.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="ip/index.html" title="mod aster_kernel::util::net::options::ip">ip</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="mod" href="netlink/index.html" title="mod aster_kernel::util::net::options::netlink">netlink</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="mod" href="socket/index.html" title="mod aster_kernel::util::net::options::socket">socket</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="mod" href="tcp/index.html" title="mod aster_kernel::util::net::options::tcp">tcp</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="mod" href="utils/index.html" title="mod aster_kernel::util::net::options::utils">utils</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.CSocketOptionLevel.html" title="enum aster_kernel::util::net::options::CSocketOptionLevel">CSocket<wbr>Option<wbr>Level</a></dt><dd>Socket level.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.RawSocketOption.html" title="trait aster_kernel::util::net::options::RawSocketOption">RawSocket<wbr>Option</a></dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.new_raw_socket_option.html" title="fn aster_kernel::util::net::options::new_raw_socket_option">new_<wbr>raw_<wbr>socket_<wbr>option</a></dt></dl></section></div></main></body></html>